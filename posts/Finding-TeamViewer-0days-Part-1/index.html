<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Finding TeamViewer 0days - Part I" /><meta name="author" content="Peter Gabaldon" /><meta property="og:locale" content="en" /><meta name="description" content="Finding TeamViewer 0days. Part 1: The story begins" /><meta property="og:description" content="Finding TeamViewer 0days. Part 1: The story begins" /><link rel="canonical" href="https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/" /><meta property="og:url" content="https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/" /><meta property="og:site_name" content="Peter Gabaldon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-04T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Finding TeamViewer 0days - Part I" /><meta name="twitter:site" content="@PedroGabaldon" /><meta name="twitter:creator" content="@Peter Gabaldon" /><meta name="google-site-verification" content="n4hbrMWNSEClBGstZ5tfJRPe9iWSPul3FA1_3mEJFgQ" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Peter Gabaldon"},"description":"Finding TeamViewer 0days. Part 1: The story begins","url":"https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/","@type":"BlogPosting","headline":"Finding TeamViewer 0days - Part I","dateModified":"2024-10-11T20:57:41+02:00","datePublished":"2024-10-04T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/"},"@context":"https://schema.org"}</script><title>Finding TeamViewer 0days - Part I | Peter Gabaldon</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-N6LPQ2XQ6P"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-N6LPQ2XQ6P'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/Peter_avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Peter Gabaldon</a></div><div class="site-subtitle font-italic">Cybersecurity blog.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/PeterGabaldon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/PedroGabaldon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Finding TeamViewer 0days - Part I</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><p>&nbsp;&nbsp;&nbsp;</p><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Finding TeamViewer 0days - Part I</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Oct 4, 2024, 12:00 AM +0200" > Oct 4, 2024 <i class="unloaded">2024-10-04T00:00:00+02:00</i> </span> by <span class="author"> Peter Gabaldon </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Oct 11, 2024, 8:57 PM +0200" > Oct 11, 2024 <i class="unloaded">2024-10-11T20:57:41+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3481 words">19 min</span></div></div><div class="post-content"><h1 id="finding-teamviewer-0days-part-1-the-story-begins">Finding TeamViewer 0days. Part 1: The story begins</h1><p>This series of blog posts are about some findings related to TeamViewer (TV) IPC communication with its SYSTEM service. I was trying to find some vulnerabilities in TeamViewer client and ended up researching how the communication with its helper service works. After being able to <em>spoof</em> (just some simple authentication as we will see) a valid TeamViewer client when connecting to the SYSTEM service IPC, it was possible to trigger an arbitrary driver installation. TeamViewer was not verifying the signature of the driver being installed. They passed the arbitrary <em>inf</em> to <em>UpdateDriverForPlugAndPlayDevices</em>.</p><p>Thus a privilege escalation USER to KERNEL was possible thanks to TeamViewer.</p><p>As we will see, one of the best approaches is to use the well-known technique <em>BYOD, Bring Your Own Vulnerable Driver</em> to load a valid signed driver into Windows Kernel and then exploit it in order to perform privileged actions from user level, like changing the token of an arbitrary process with a privileged one.</p><p><a href="../../assets/img/finding-tv-0days-1/logo.webp" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/logo.webp" alt="" /></a></p><h2 id="background">Background</h2><p>First of all, some background in order to understand some later things. This vulnerability is not exploitable when TeamViewer is just run on the system, it is necessary to install TeamViewer.</p><p>When TeamViewer is installed on the system, it creates a service that runs as SYSTEM, <em>TeamViewer_service.exe</em></p><p>This service is a helper for the client to some tasks. Thus, the client does not run with elevated privileges and some tasks are delegated to the service.</p><p>The communication with the service (IPC) is implemented through sockets (using <em>Overlapped I/O</em> and <em>IoCompletionPort</em>). By default, TeamViewer SYSTEM services listens on <strong><em>5939/tcp</em></strong> at localhost.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>C:\Windows\system32&gt;netstat -ano | findstr /i 15792
  TCP    127.0.0.1:5939         0.0.0.0:0              LISTENING       15792
  TCP    127.0.0.1:5939         127.0.0.1:64668        ESTABLISHED     15792
  [...]
</pre></table></code></div></div><p>I tested and the exploit worked on the following TV versions:</p><ul><li>15.53.7<li>15.54.6</ul><p>While testing with TeamViewer some functionality attracted my attention. The ability to install its VPN and Printer Driver just by click. I tested with an unprivileged users and it worked too.</p><p>Curiosity killed the cat.</p><p>So, the question is, how is that implemented :)? And the journey researching started.</p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617222935.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617222935.png" alt="" /></a></p><h2 id="first-steps">First Steps</h2><p>At my first try, I was running TV with an administrator user, although with Medium Integrity Level.</p><p>So I tried launching the Driver Install with an unprivileged user and that <strong>worked too</strong>.</p><p>TeamViewer logged the installation process. Fourth columns indicates <em>which</em> entity logged. <em>S0</em> is for SYSTEM process logs. The symbol after <em>S0</em> indicates the type of log, <em>+</em> appears to indicate level of verbosity. More <em>+</em>, move verbose. When a error occurs, <em>!</em> are used.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>2024/05/26 20:36:39.130  2036      10604 S0+  GetSimpleDisplayCertNameFromFile: Found cert name: 'TeamViewer Germany GmbH'.
2024/05/26 20:36:39.130  2036      10604 S0+  VerifyTeamViewerCertificate: File for loading certificate is C:\Program Files\TeamViewer\tv_x64.exe
2024/05/26 20:36:39.130  2036      10604 S0+  VerifyTeamViewerCertificate: SHA256 code path.
2024/05/26 20:36:39.130  2036      10604 S0+  SHA256 certificate check.
2024/05/26 20:36:39.130  2036      10604 S0+  VerifyCertHash(): Certificate check succeded.
2024/05/26 20:36:39.130  2036      10604 S0+  tvnetwork::IpcLoaderProcessHandlerWin::Received_StartLoaderProcess: Starting Loader Process C:\Program Files\TeamViewer\tv_x64.exe (type 2) for ID 1500170772 in session 2 with args --action install --verbose --log C:\Program Files\TeamViewer\TeamViewer15_Logfile.log  --event Local\DriverInstallFinishEvent_VPN --inf C:\Program Files\TeamViewer\x64\TeamViewerVPN.inf --id TEAMVIEWERVPN
2024/05/26 20:36:39.130  2036      10604 S0   CToken::GetSystemToken() set session 2
2024/05/26 20:36:39.130  2036      10604 S0+  ProcessWin::CreateProcessInternal: CreateProcess C:\Program Files\TeamViewer\tv_x64.exe AsUser
2024/05/26 20:36:39.130  2036      10604 S0   tvnetwork::IpcLoaderProcessHandlerWin::Received_StartLoaderProcess: Loader process started, pid = 13920
2024/05/26 20:36:39.146 13920 14904 L64  Loader started with: "C:\Program Files\TeamViewer\tv_x64.exe" --action install --verbose --log C:\Program Files\TeamViewer\TeamViewer15_Logfile.log  --event Local\DriverInstallFinishEvent_VPN --inf C:\Program Files\TeamViewer\x64\TeamViewerVPN.inf --id TEAMVIEWERVPN
</pre></table></code></div></div><p>Notice last line, where it is possible to observer that a helper binary is being launched as SYSTEM.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2024/05/26 20:36:39.146 13920 14904 L64  Loader started with: "C:\Program Files\TeamViewer\tv_x64.exe" --action install --verbose --log C:\Program Files\TeamViewer\TeamViewer15_Logfile.log  --event Local\DriverInstallFinishEvent_VPN --inf C:\Program Files\TeamViewer\x64\TeamViewerVPN.inf --id TEAMVIEWERVPN
</pre></table></code></div></div><p>Interesting, a SYSTEM process is being created that installs the driver given an <em>INF</em> file. This process ends calling <code class="language-plaintext highlighter-rouge">UpdateDriverForPlugAndPlayDevicesA</code> without verification of the signature (<em>Catalog File</em>).</p><ul><li><a href="https://learn.microsoft.com/en-us/windows/win32/api/newdev/nf-newdev-updatedriverforplugandplaydevicesa" target="_blank">https://learn.microsoft.com/en-us/windows/win32/api/newdev/nf-newdev-updatedriverforplugandplaydevicesa</a></ul><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617225325.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617225325.png" alt="" /></a> <a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617225340.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617225340.png" alt="" /></a></p><p>Where that parameters come from?</p><p>I started then investigating the IPC communication. After some <em>API Monitor</em> (what a f*cking such great tool) hours. I will not bore you with the trial and error of different filters and time studying IPC communication. We now know that is using <em>5939/tcp</em>, so lets analyze <em>Networking APIs</em>.</p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617225946.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617225946.png" alt="" /></a></p><p>When launching TV it is possible to see that it is using a proprietary protocol. One can think at first that it is encrypted or something like that. But not, TV is not using encryption on its communication.</p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617230110.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617230110.png" alt="" /></a></p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617230549.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617230549.png" alt="" /></a></p><p>The interesting part is, what happens when the button of <em>Install VPN Driver</em> is clicked?</p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617231058.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617231058.png" alt="" /></a></p><p>Oh, oh, Houstonâ€¦</p><p>The client is sending the <em>INF</em> parameter to the SYSTEM service and the SYSTEM service calling the <em>tv_x64.exe</em> with that parameter.</p><p>So the idea was clear, if we send an IPC message to the SYSTEM service indicating an arbitrary <em>INF</em> parameter, will we install an arbitrary driver?</p><p>Here is another view from Wireshark.</p><p><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240617231517.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240617231517.png" alt="" /></a></p><p>(Not just the INF parameter is send, but I am skipping the other part as the most relevant one is the INF parameter. Notice the Event message <em>Local\DriverInstallFinishEvent</em>).</p><h2 id="ipc-communication-protocol">IPC Communication Protocol</h2><p>This part is the consequence of all the reversing and research of the TV adventure. Chronologically it should be placed the last one, but I think the next sections will be understood better if we first study the IPC communication protocol.</p><p>TV IPC messages are simple. The all have the following structure.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>HEADER
BODY
TAIL
</pre></table></code></div></div><p>We have a <em>Header</em> that contains some metadata for the message itself, like the length, the type of message, the length of itself, etc.</p><p>We then have the body with the data of the message at issue.</p><p>Finally we have a tail that contains always the same signature plus some identifier.</p><h2 id="header">HEADER</h2><p>The header is 8-bytes long, but I will consider it as 16-bytes long because after that comes another sub header of another 8 bytes before the body. So, to our understanding, we have 16-byte header before the body. It contains the following fields, where <em>IDK</em> means <em>I donâ€™t kwon</em>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>|  0   ||  1   ||  2   ||  3   ||  4   ||  5   ||  6   ||  7   ||  8   ||  9   ||  10   ||  11   ||  12   ||  13   ||  14   ||  15   ||  16   |

| Length of Header || IDK || IDK || IDK || 4-byte Msg Length || 3-byte Msg Length || 2-byte Msg Length || 1-byte Msg Length || IDK || Type of Message || IDK || Direction (Client or Server MSG) || IDK || IDK || IDK || IDK |
</pre></table></code></div></div><p>I have always see the header having 8-bytes, so the first byte of the message is always 0x08.</p><h2 id="body">BODY</h2><p>What to say? This part contains the non-encrypted data. Like the <em>INF</em> parameter :).</p><h2 id="tail">TAIL</h2><p>I have found that the last part of the IPC message may vary, but it always start with <em>0xfe 0x01 0x00 0x00</em></p><p>I have not investigate in depth this part, I have always maintain the same bytes copied from capture messages.</p><p>The last 4-bytes appears to be an identifier.</p><p>Here are the exact messages most relevant for this research.</p><h3 id="authentication-messages">Authentication Messages</h3><p>I will get into more detail about the authentication process in the dedicated part about it (Part 2). This subsection will describe the message itself.</p><p>The authentication process has two types of messages. One type of messages that is used by the client and the other type of message that is used by the server. The difference between this two is that <em>Client -&gt; Server</em> message contains 8-byte in the body, while the server contains 16-byte in the body. We will see it later why.</p><p><strong>Messages from client to server</strong></p><p>Here it is possible to see a message from client to server that we will thresh.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>0000   08 00 01 00 1d 00 00 00 2d 02 09 10 00 00 00 b7   ........-.......
0010   48 77 26 8a 72 b8 f0 fe 57 04 03 fc 64 2e b0 fe   Hw&amp;.r...W...d...
0020   01 00 00 00 01                                    .....
</pre></table></code></div></div><ul><li>First of all we have the header<ul><li><code class="language-plaintext highlighter-rouge">08 00 01 00 1d 00 00 00</code><li>As we can see it is 8-bytes long (as indicated by the first byte). The next three bytes appear to be always the same and I do not known exactly their task.<li>Then we have the next 4-bytes, indicating the length of the message.</ul><li>The we have the <em>sub header</em><ul><li><code class="language-plaintext highlighter-rouge">2d 02 09 10 00 00 00</code><li>This <em>sub header</em> is indicating the type of message. <code class="language-plaintext highlighter-rouge">2d 02 09</code> is for <em>Authentication Message</em> client to server, while, as we will see, <code class="language-plaintext highlighter-rouge">2d 03 09</code> is for <em>Authentication Message</em> Server to client<li>I do not know what <code class="language-plaintext highlighter-rouge">10 00 00 00</code> represent, it is the same sequence in both direction of the message.</ul><li>Then we have the 16-byte challenge sent by the client to the server.<ul><li><code class="language-plaintext highlighter-rouge">b7 48 77 26 8a 72 b8 f0 fe 57 04 03 fc 64 2e b0</code></ul><li>At the end we have the tail. I dot not know exactly what indicates this bytes, but it is always the same.<ul><li><code class="language-plaintext highlighter-rouge">fe 01 00 00 00 01</code></ul></ul><p><strong>Message from Server to Client</strong></p><p>Here it is possible to see a message from server to the client that we will thresh too.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>0000   08 00 01 00 32 00 00 00 2d 03 09 10 00 00 00 29   ....2...-......)
0010   7e d4 88 48 ed 9e 18 5c 3a 4a 12 ce 6e ab 22 0a   ~..H...\:J..n.".
0020   10 00 00 00 4b 85 07 8b 3f 21 76 0d a5 fa 62 9b   ....K...?!v...b.
0030   a7 5e d1 4a fe 01 00 00 00 01                     .^.J......
</pre></table></code></div></div><p>In this case, we have mostly the same, but in this case the message is larger because we have two 16-byte message in this body. The first 16-byte is the challenge sent by the server and the next 16-byte is the response to our sent challenge.</p><ul><li>First of all we have the header<ul><li><code class="language-plaintext highlighter-rouge">08 00 01 00 1d 00 00 00</code><li>As we can see it is 8-bytes long (as indicated by the first byte). The next three bytes appear to be always the same and I do not known exactly their task.<li>Then we have the next 4-bytes, indicating the length of the message.</ul><li>The we have the <em>sub header</em><ul><li><code class="language-plaintext highlighter-rouge">2d 03 09 10 00 00 00</code><li>This <em>sub header</em> is indicating the type of message, <code class="language-plaintext highlighter-rouge">2d 03 09</code>. Notice that before we had <code class="language-plaintext highlighter-rouge">2d 03 09</code>.<li>I do not know what <code class="language-plaintext highlighter-rouge">10 00 00 00</code> represent, it is the same sequence in both direction of the message.</ul><li>Then we have the 16-byte challenge sent by the server to the client.<ul><li><code class="language-plaintext highlighter-rouge">29 7e d4 88 48 ed 9e 18 5c 3a 4a 12 ce 6e ab 22</code></ul><li>After that comes the <em>separator</em><ul><li><code class="language-plaintext highlighter-rouge">0a 10 00 00 00</code></ul><li>Then we have the response to our challenge from the server.<ul><li><code class="language-plaintext highlighter-rouge">4b 85 07 8b 3f 21 76 0d a5 fa 62 9b a7 5e d1 4a</code></ul><li>At the end we have the tail. I dot not know exactly what indicates this bytes, but it is always the same.<ul><li><code class="language-plaintext highlighter-rouge">fe 01 00 00 00 01</code><h3 id="control-ipc-message">Control IPC Message</h3></ul></ul><p>Once the authentication has completed successfully the client sent to the server a message that contains the PID of process connecting and a identifier and the version, that need to Mach with the TeamViewer Service version. There is more data but I have not researched about it and appeared to not be relevant, so I just maintain the same bytes when connecting from the exploit.</p><p>Here is an example message.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>0000   08 00 01 00 ac 00 00 00 01 12 01 04 00 00 00 78   ...............x
0010   22 00 00 02 04 00 00 00 02 00 00 00 03 01 00 00   "...............
0020   00 00 04 12 00 00 00 31 00 35 00 2e 00 35 00 33   .......1.5...5.3
0030   00 2e 00 37 00 20 00 00 00 05 04 00 00 00 01 00   ...7. ..........
0040   00 00 06 06 00 00 00 65 00 6e 00 00 00 07 01 00   .......e.n......
0050   00 00 00 09 06 00 00 00 31 00 35 00 00 00 0a 06   ........1.5.....
0060   00 00 00 35 00 33 00 00 00 0b 04 00 00 00 37 00   ...5.3........7.
0070   00 00 0d 01 00 00 00 01 0e 04 00 00 00 dd 7b a7   ..............{.
0080   37 0f 04 00 00 00 1d bf 52 39 11 04 00 00 00 01   7.......R9......
0090   00 00 00 f3 04 00 00 00 02 00 00 00 fd 04 00 00   ................
00a0   00 fd cf ff 02 fe 01 00 00 00 01 ff 04 00 00 00   ................
00b0   8c 83 14 3b                                       ...;
</pre></table></code></div></div><p>Again, we start with a similar header.</p><ul><li>First of all we have the header<ul><li><code class="language-plaintext highlighter-rouge">08 00 01 00 ac 00 00 00</code><li>As we can see it is 8-bytes long (as indicated by the first byte). The next three bytes appear to be always the same and I do not known exactly their task.<li>Then we have the next 4-bytes, indicating the length of the message.</ul><li>The we have the <em>sub header</em><ul><li><code class="language-plaintext highlighter-rouge">01 12 01 04 00 00 00</code>. This indicates the type of message.</ul><li>Then, we have 4-byte indicating the PID connecting.<ul><li><code class="language-plaintext highlighter-rouge">78 22 00 00</code>. 8824 in this case.</ul><li>Then, in bytes 0x27 to 0x34 we have the version of TeamViewer. In this case it is 15.53.7.<ul><li>This needs to match with the TeamViewer service. In this case, if the TeamViewer client indicates a version different of 15.53.7 the IPC connection will be terminated by the service because of the version mismatch.<li><code class="language-plaintext highlighter-rouge">31 00 35 00 2e 00 35 00 33 00 2e 00 37</code></ul><li>The version is later on the message again, but separated by each number of the versoin.<ul><li>In bytes 0x58 to 0x5b we have the major number of the version. 15 in this case<li>In bytes 0x63 to 0x66 we have the medium number of the version.<li>In bytes 0x6e to 0x6f we have the last number of the version.</ul><li><a href="../../assets/img/finding-tv-0days-1/Pasted image 20240621210706.png" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/img/finding-tv-0days-1/Pasted image 20240621210706.png" alt="" /></a><li>The rest of the body I do not known what it does, it was necessary only to write the correct PID.<li>In this case the tail is a bit different because it contains the following bytes after the common one, <code class="language-plaintext highlighter-rouge">ff 04 00 00 00 95 d4 04 31</code>.<li>At the end there it is a generated identifier that is used in later messages.<ul><li><code class="language-plaintext highlighter-rouge">8c 83 14 3b</code></ul><li>I have also see that the language is indicate in this message. In this case <em>en</em>.<h3 id="driver-install-request-message">Driver Install Request Message</h3></ul><p>Once we have authenticated and we have send the <em>Control IPC message</em> with the correct PID we are able to send the <em>Driver Install Message</em>. YUP! :).</p><p>In this message, among other things, we are indicating the <em>â€“inf</em> parameter that will be used later by the SYSTEM process, allowing us to install an arbitrary Kernel Driver from an unprivileged user.</p><p>Here is an example message.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>0000   08 00 01 00 35 01 00 00 33 0c 01 01 00 00 00 01   ....5...3.......
0010   02 04 00 00 00 02 00 00 00 03 96 00 00 00 2d 00   ..............-.
0020   2d 00 69 00 6e 00 66 00 20 00 43 00 3a 00 5c 00   -.i.n.f. .C.:.\.
0030   4e 00 6f 00 74 00 20 00 50 00 72 00 6f 00 67 00   N.o.t. .P.r.o.g.
0040   72 00 61 00 6d 00 20 00 46 00 5c 00 61 00 61 00   r.a.m. .F.\.a.a.
0050   61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00   a.a.a.a.a.a.a.a.
0060   5c 00 62 00 62 00 62 00 5c 00 41 00 6e 00 6f 00   \.b.b.b.\.A.n.o.
0070   74 00 68 00 65 00 72 00 54 00 68 00 69 00 6e 00   t.h.e.r.T.h.i.n.
0080   67 00 67 00 2e 00 69 00 6e 00 66 00 20 00 2d 00   g.g...i.n.f. .-.
0090   2d 00 69 00 64 00 20 00 54 00 45 00 41 00 4d 00   -.i.d. .T.E.A.M.
00a0   56 00 49 00 45 00 57 00 45 00 52 00 56 00 50 00   V.I.E.W.E.R.V.P.
00b0   4e 00 00 00 05 02 00 00 00 00 00 06 02 00 00 00   N...............
00c0   00 00 07 01 00 00 00 00 08 46 00 00 00 4c 00 6f   .........F...L.o
00d0   00 63 00 61 00 6c 00 5c 00 44 00 72 00 69 00 76   .c.a.l.\.D.r.i.v
00e0   00 65 00 72 00 49 00 6e 00 73 00 74 00 61 00 6c   .e.r.I.n.s.t.a.l
00f0   00 6c 00 46 00 69 00 6e 00 69 00 73 00 68 00 45   .l.F.i.n.i.s.h.E
0100   00 76 00 65 00 6e 00 74 00 5f 00 56 00 50 00 4e   .v.e.n.t._.V.P.N
0110   00 00 00 09 04 00 00 00 00 00 00 00 f3 04 00 00   ................
0120   00 02 00 00 00 fd 04 00 00 00 01 00 00 00 fe 01   ................
0130   00 00 00 01 ff 04 00 00 00 95 d4 04 31            ............1
</pre></table></code></div></div><ul><li>First of all we have the header<ul><li><code class="language-plaintext highlighter-rouge">08 00 01 00 35 01 00 00</code><li>As we can see it is 8-bytes long (as indicated by the first byte). The next three bytes appear to be always the same and I do not known exactly their task.<li>Then we have the next 4-bytes, indicating the length of the message.</ul><li>The we have the <em>sub header</em><ul><li><code class="language-plaintext highlighter-rouge">33 0c 01 01 00 00 00</code>. This indicates the type of message.</ul><li>Then, we have 22 bytes that I always maintain the same and I actually do not kwow that the mean.<li>After that, there is the <em>â€“inf</em> parameter string.<li>There comes some other parameters and the end.<li>In this case the tail is a bit different because it contains the following bytes after the common one, <code class="language-plaintext highlighter-rouge">ff 04 00 00 00 95 d4 04 31</code>.<h2 id="first-fail-authentication-needed">First Fail: Authentication needed</h2></ul><p>My first try was to just send the Driver installation request. Short story, it does not work.</p><p>I started looking at the log and it contained an error message from the <em>IPC Structure Parser</em> because it is expecting some type of message (the authentication one) that is different from the one we are sending.</p><p>It was then when I started capturing legitimate traffic and searching for patterns. I notice that the server was sending the 16-byte message shown before and that when sending the same first message the server responds back with the same 16-byte.</p><p><em>ChatGPT</em> started to help me to perform some analytical analysis from different inputs and we concluded that TV was using some type of encryption or hashing and not simple binary operations.</p><p>When sending a well formatted message TV started to log <em>invalid response</em> from <em>Received_IPC_Auth()</em>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2024/05/26 19:03:04.770  3268       3660 S0!! InterProcessNetwork::Received_IPCAuth() invalid response
</pre></table></code></div></div><p>So, we have to correctly authenticate first. As we will see, the authentication algorithm is not robust.</p><h2 id="second-fail-failing-back-to-reversing">Second Fail: Failing back to reversing</h2><p>Before starting reversing I tried if it was possible to take a shortest path. I tried to figure if there where some way of making TV showing why the authentication was failing.</p><p>I found a way to enable verbose and debug log output. TV do not log why the authentication is failing in the IPC, but I think is work mentioning and documenting all the registry keys the TV service tries to query and to take a note on the most interesting ones.</p><p>I attach the process monitor result here: TODO INSERT LINK</p><ul><li><em>IPC_Port_Service</em>: can be used to change the port where the SYSTEM service IPC listens.<li><em>Log_Level</em>: it enables to modify the type of logs included. A tried so many values but did not take note of all sorry. Only for the debug, <strong>0x40</strong>.<li><em>LogLevelVerboseStarted</em>: I have not seen any difference, but apparently it enables verbosity logging.<li><em>IPCPassword</em>: I have not tested it, but it should change the IPC secret.<li><em>HooksLogVerbose</em>: enable logging TV <em>hooks</em> in the file <em>TeamViewer15_Hooks.log</em>.</ul><p>This approach was not successful, unless it was funny to understand another parts of TV. Like enabling debug output in the logs for example, and I think is worth the time.</p><p>Finally, I ended up reversing the authentication mechanism. We will see that in detail in Part 2.</p><p>After that, in Part 3, we will take a look at the exploit and how all the gear parts agree in order to enable privilege scalation from user to Kernel.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/en/'>en</a>, <a href='/categories/windows-security/'>Windows security</a>, <a href='/categories/teamviewer/'>TeamViewer</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/cybersecurity/" class="post-tag no-text-decoration" >cybersecurity</a> <a href="/tags/cve-2024-7479/" class="post-tag no-text-decoration" >CVE-2024-7479</a> <a href="/tags/cve-2024-7481/" class="post-tag no-text-decoration" >CVE-2024-7481</a> <a href="/tags/zdi-24-1289/" class="post-tag no-text-decoration" >ZDI-24-1289</a> <a href="/tags/zdi-24-1290/" class="post-tag no-text-decoration" >ZDI-24-1290</a> <a href="/tags/tv-2024-1006/" class="post-tag no-text-decoration" >tv-2024-1006</a> <a href="/tags/red-team/" class="post-tag no-text-decoration" >red team</a> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >pentesting</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Finding TeamViewer 0days - Part I - Peter Gabaldon&url=https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Finding TeamViewer 0days - Part I - Peter Gabaldon&u=https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Finding TeamViewer 0days - Part I - Peter Gabaldon&url=https://petergabaldon.github.io/posts/Finding-TeamViewer-0days-Part-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/FortiGate-VPN-SSL-Honeypot/">FortiGate VPN-SSL Honeypot</a><li><a href="/posts/Bypass-Azure-Admin-Approval-Mode-Enumeration/">Bypass Azure Admin Approval Mode for User Consent Workflow When Enumerating</a><li><a href="/posts/Finding-TeamViewer-0days-Part-1/">Finding TeamViewer 0days - Part I</a><li><a href="/posts/Finding-TeamViewer-0days-Part-3/">Finding TeamViewer 0days - Part III</a><li><a href="/posts/Diamond-And-Sapphire-Tickets/">Diamond And Sapphire Tickets</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cybersecurity/">cybersecurity</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/red-team/">red team</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/cve-2024-7479/">CVE-2024-7479</a> <a class="post-tag" href="/tags/cve-2024-7481/">CVE-2024-7481</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a> <a class="post-tag" href="/tags/tv-2024-1006/">tv-2024-1006</a> <a class="post-tag" href="/tags/zdi-24-1289/">ZDI-24-1289</a> <a class="post-tag" href="/tags/zdi-24-1290/">ZDI-24-1290</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Playing-With-Windows-Security-Part-1/"><div class="card-body"> <span class="timeago small" > Feb 4, 2021 <i class="unloaded">2021-02-04T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Playing With Windows Security - Part 1</h3><div class="text-muted small"><p> Windows Authentication. In this first part of Windows hacking we will be covering aspects related on how Windows authentication works. Iâ€™m coming from Linux ecosystem so sometimes I will try to co...</p></div></div></a></div><div class="card"> <a href="/posts/Playing-With-Windows-Security-Part-2/"><div class="card-body"> <span class="timeago small" > Feb 21, 2021 <i class="unloaded">2021-02-21T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Playing With Windows Security - Part 2</h3><div class="text-muted small"><p> Kerberos Authentication Protocol After the first part at which we talked about authentication in Windows and explained how attacks like Pass-The-Hash works. At this part we are going to analyse Ke...</p></div></div></a></div><div class="card"> <a href="/posts/Diamond-And-Sapphire-Tickets/"><div class="card-body"> <span class="timeago small" > Oct 14, 2022 <i class="unloaded">2022-10-14T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Diamond And Sapphire Tickets</h3><div class="text-muted small"><p> Kerberos Diamond and Sapphire Tickets As you may known, one of the approaches for persistence in a Windows Active Directory are the well-known techniques Golden Ticket and Silver Ticket. In the po...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled"><p>-</p></span> <a href="/posts/Finding-TeamViewer-0days-Part-2/" class="btn btn-outline-primary"><p>Finding TeamViewer 0days - Part II</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://twitter.com/PeterGabaldon">Pedro Gabaldon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cybersecurity/">cybersecurity</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/red-team/">red team</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/cve-2024-7479/">CVE 2024 7479</a> <a class="post-tag" href="/tags/cve-2024-7481/">CVE 2024 7481</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a> <a class="post-tag" href="/tags/tv-2024-1006/">tv 2024 1006</a> <a class="post-tag" href="/tags/zdi-24-1289/">ZDI 24 1289</a> <a class="post-tag" href="/tags/zdi-24-1290/">ZDI 24 1290</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://petergabaldon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
